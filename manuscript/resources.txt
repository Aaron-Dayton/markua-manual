# Resources

Markua documents are composed of a number of text files. Each of these text files can insert any number of resources in them, either inline or as figures.

## Six Types of Resource Content

There are six types of resources that can be inserted into a Markua document:

1. Images
2. Video
3. Audio
4. Code
5. Math
6. Text

Markua Processors rely on file extension to determine the type of media and must not attempt to parse files to determine their type. Because of this, the choice of acceptable file extensions for the various media types is a subset of the total available, so that audio and video files can be distinguished solely by their file extension instead of by examining the file or by requiring authors to type some special metadata syntax.

Regardless of what type of resource it is, all resources have the same options regarding:

* Resource Locations: Local and Web
* Resource Definition: Inline and Reference
* Resource Insertion: Span and Figure

Examples of all of this will come later.

### Why Support Audio and Video?

Obviously, embedding audio and video does not work for printed books and documents. It also won't work in many ebook readers and some ebook formats. However, for the applications (e.g. high school and first year university textbooks) where audio and video would be useful, it would be really, really useful. To not support audio and video would be to be a curmudgeon, and limit use cases that I didn't personally consider important for no good reason. Worse, it would be encouraging the dominance of proprietary ebook creation tools for those use cases. The textbook market is a disgusting, exploitative scam that needs to be disrupted, and if adding audio and video to Markua helps this in any way, then it's worth doing, even if there were no other legitimate reasons.

## Resource Locations: Local and Web

In terms of where they are located, there are two types of resources: local and web.

Local Resources
: The resource is included with the manuscript files, in a `resources` folder inside the `manuscript` folder.

Web Resources
: The resource is defined somewhere on the web, and is available via the `http:` or `https:` protocols.

All Markua Processors must support all types of Local Resources. However, due to the nightmare that is current copyright law, support for Web Resources is optional in Markua Processors. Furthermore, support for Web Resources is not all or nothing -- a Markua Processor can support Web Resources for some resource types but not others. For example, a Markua Processor could support Web Resources for code, math and text, but not for images, audio and video. If a Markua Processor does not support a particular type of Web Resource, it must consider all Web Resources of to be missing resources at the time of book or document generation, and use fallback resources or alt text if provided.

### Local Resources

The `resources/` directory is not included in the path in the Markua manuscript; it is present in the generated HTML.

All images identified with a directory path must be inside the `resources` directory or one of its subdirectories. Implementors of Markua Processors must ensure they do not support navigating upward with `../` in paths.

The local resources approach can also be used by hosted services. If they provide a download they should create a resources directory... TODO

A file called `foo.jpg` in the `resources` directory is referenced as `![](foo.jpg)` -- not as `![](/foo.jpg)`, `![](resources/foo.jpg)` or  `![](/resources/foo.jpg)`.

A file called `bar.png` in a subdirectory `foo` of the resources directory is referenced as `![](foo/bar.png)` -- not as `![](/foo/bar.png)`, `![](resources/foo/bar.png)` or  `![](/resources/foo/bar.png)`.

W> In Leanpub Flavoured Markdown, we included `images/` in the path of all images. This is not supported in Markua. If  Not only is it redundant, it incorrectly implies that the directory could be named anything, which is not the case. So, if there is resources/ in a path, a Markua processor **must** assume this is the name of a directory *inside* the resources directory.

### Web Resources

The URL approach with an image is simple: the URL is an absolute URL of an image on the internet. The URL must start with with either `http:` or `https:`; no other protocols are supported.

## Resource Definition: Inline and Reference

Resources can be defined in one of two ways:

Inline
: The resource is defined right where it is inserted.

Reference
: The resource is defined separate from where it is inserted, and it is inserted in one or more places in the manuscript. The reference syntax also has the ability to define replacement resources and/or images if a particular resource is either missing or its format is not supported.

Unlike with images which are supported in most circumstances, with audio or video files it's currently a bit of a crapshoot. With audio, there are MP3, AAC, Ogg and WAV formats all in widespread use, and there are a number of other formats with supporters. With video, there's currently a dominant proprietary format (H.264, or .mp4) and a new open source challenger (WebM). It's entirely likely that for a given ebook reader, any given audio or video format will not be supported, and as an ebook author you should be prepared to provide a fallback resource format and/or a fallback image for situations (including print books) where a resource will never work.

As such, both the inline and reference methods for defining an resource support defining an arbitrary number of fallback resources or images. The reason to provide a fallback resource is to provide essentially the same content in a different format; the reason to provide a fallback image is to provide a suitable replacement in a situation where resources are not supported at all.

If a Markua Processor is outputting a print book or some format where it is known that resource is not supported, it must choose the first fallback image. If no fallback image is provided and a Markua Processor is outputting a format in which resources are not supported, a missing audio or video image placeholder must be output. The look of this missing audio or video image is not specified in Markua; it can either be deliberately ugly (like the missing image icon in web browsers circa 1995) or it can be attractive.

My assumption is that in most cases authors will only provide alt text and a fallback image, or not provide anything at all. My hope is that at least alt text is provided.

Besides the fallback image, authors can also provide a thumbnail video TODO - figure this out

### Defining Resources Inline

An resource can be defined inline, right where it is inserted.

This syntax can be briefly described as follows:

`![Optional Alt Text](resource_path_or_url "Optional Figure Caption")`

This is the preferred way in Markua to insert normal images which are only used once. The optional alt text and the optional figure caption are discussed after the Reference Images syntax is explained, since they are relevant for both syntaxes.

With fallback media, this looks like this:

`![Optional Alt Text](resource_path_or_url fallback_path_or_url_1 fallback_path_or_url_2 ... fallback_path_or_url_n "Optional Figure Caption")`

(The ellipses above are obviously not in the syntax; I'm just using that to show that n fallback media elements can be defined here.)

### Defining Resources by Reference

In this syntax, an `id` is first defined for a resource, like this:

[resource_id]: resource_path_or_url "Optional Figure Caption"

With fallback media, this looks like this:

[resource_id]: resource_path_or_url fallback_path_or_url_1 fallback_path_or_url_2 ... fallback_path_or_url_n "Optional Figure Caption"`

(The ellipses above are obviously not in the syntax; I'm just using that to show that n fallback media elements can be defined here.)

This `id` can then be used to insert the resource, like this:

`![Optional Alt Text][resource_id]`

You'll see more about resource insertion in the next section.

Note that the Optional Figure Caption is defined with the definition of the resource, and this figure caption is used every single time the image is inserted via its `id`. I considered using a definition list syntax for defining resources, and supporting different figure captions based on which resource was used. However, I decided that this was objectionable: the text of a book should not change based on the capabilities of the ebook reader, and I consider figure captions to be book text. So, since the alternative caption use case was not legitimate, the need for the definition list syntax evaporated with it. (Yes, there will be line wrapping if there are a number of fallback media defined; that's preferable to having two syntaxes to do the same thing.)

The reference style of resource definition and insertion is supported for the following two reasons:

1. If an author who is familiar with Markdown strongly prefers it, there's no reason not to provide it. (There's nothing else that Markua would do with the reference syntax.)
2. For images which are used frequently (e.g. emoji), it is much better to define it once and use it multiple times.

## Resource Insertion: Span and Figure

Regardless of whether an resource is defined inline or by reference, an resource can also inserted into the flow of a Markua document in one of two ways:

Span
: The resource is inserted as part of the flow of text of a paragraph.

Figure
: The resource is inserted as a figure, either nested in a paragraph like a block quote or as a top-level element.

When inserting an resource as a span element in the flow of a paragraph, Markua Processors will want to use a very small (possibly emoji-sized) thumbnail for the resource. Otherwise, the paragraph would quickly look ridiculous, as a typical resource thumbnail is many times the height of a typical line of text.

{#spanimages}
### Span Resources

Images can be inserted as a span image in the flow of text in a paragraph. When an image is inserted as a span image, it must be positioned where it is inserted -- it cannot be floated and repositioned by Markua processors.

A span image cannot have a caption. If a caption is present, a Markua processor will ignore it. (A Markua processor may add a warning to the list of warnings which are reported in book generation, but no warning is added to the text itself.)

#### Examples of Span Images

##### Example 1: Span Images with Alt Text

Images can be inserted as a span image with alt text. Again, the alt text is intended to be read or heard instead of the image by readers who can't see the image, so it's important.

###### Markua Syntax

{#input_span_images_1}
```
Markua has a fancy ![Markua two trees logo](markua-logo-small.png) logo!

Markua also has a fancy ![Markua two trees icon](https://pbs.twimg.com/profile_images/525513829455650817/mIba4bYL_400x400.png) Twitter avatar!
```

###### HTML Output

{#output_span_images_1}
```
<p>Markua has a fancy <img src="resources/markua-logo-small.png" alt="Markua two trees logo"/> logo!</p>
<p>Markua also has a fancy <img src="https://pbs.twimg.com/profile_images/525513829455650817/mIba4bYL_400x400.png" alt="Markua two trees icon"/> Twitter avatar!</p>
```

##### Example 2: Span Images with no Alt Text

Images can be inserted as a span image with no alt text.

###### Markua Syntax

{#input_span_images_2}
```
Markua has a fancy ![](markua-logo-small.png) logo!
```

###### HTML Output

{#output_span_images_2}
```
<p>Markua has a fancy <img src="resources/markua-logo-small.png"/> logo!</p>
```

##### Example 3: Span Images Incorrectly Having a Caption

A span image cannot have a caption. If one is present, it is ignored.

###### Markua Syntax

{#input_span_images_3}
```
Markua has a fancy ![Markua two trees logo](markua-logo-small.png "This caption is ignored") logo!
```

###### HTML Output

{#output_span_images_3}
```
<p>Markua has a fancy <img src="resources/markua-logo-small.png" alt="Markua two trees logo"/> logo!</p>
```

### Resources Inserted as Figures

The most powerful way to insert an image in Markua is as a Figure. To do this you add an image on a line by itself.

To learn more, see the [Figures](#figures) chapter.

## No Cycles

For the programmers reading this: since resources cannot themselves include resources, you cannot have cycles resulting in infinitely long Markua documents.

## Alt text

In the Markua resource syntax, just as with the Markua image syntax, the optional alt text is in square brackets before the resource insertion.  This is true for both inline and reference style of resource insertion:

* Inline: `![Optional Alt Text](resource_path_or_url "Optional Figure Caption")`
* Reference: `![Optional Alt Text][image id]`

The Optional Alt Text is text which is intended to take the place of the resource if the resource itself cannot be seen. The obvious use case is for readers with visual disabilities who are using a screen reader, but it also includes audiobooks and ebook readers which often do not support embedded images, audio and video.

While the alt text is optional, it is important to have alt text. This is one reason why the image syntax puts it in the square brackets before the image path: you need to type the square brackets whenever inserting an image, so you might as well type some alt text. Empty square brackets look ugly--like a mistake--and it's a mistake to ignore the needs of readers with visual disabilities.

The alt text should not be the same thing as the figure caption, if the figure caption is present. (Imagine having your screen reader read identical alt text and figure captions to you.) Instead, the alt text should be descriptive of the image content, while the figure caption can be more creative. For example, a figure caption may be "Washington Crossing the Delaware" and the alt text could be "Denzel Washington riding a jet ski in a river". Having good alt text would enable readers who cannot see the image to still get the joke which the figure caption makes.

## Resource Path or URL

The `resource_path_or_url` part (and the fallbacks) are the relative paths to the resource inside the `resources` directory or the URL of the image on the internet. Both of these methods are described next.

### Supported Image Formats

Markua supports GIF, PNG, JPEG and SVG images. All images must be located inside the `resources` directory, regardless of type. The images must have the correct file extension for their type. Markua processors do not need to parse images to determine their type.

The supported file extensions are:

.gif
: The file is treated as a GIF image.

.jpg
: The file is treated as a JPEG image.

.jpeg
: The file is treated as a JPEG image.

.png
: The file is treated as a PNG image.

.svg
: The image is treated as an SVG image.

.svgz
: The image is treated as an SVG image which has been zipped.

.xml
: The image is treated as an SVG image.

### Supported Video Formats

Markua supports MP4 and WebM videos. All videos must be located inside the `media` directory, regardless of type. The videos must have the correct file extension for their type.

The supported file extensions for video files are:

.mp4
: The file is treated as an MP4 video.

.webm
: The file is treated as a WebM image.

### Supported Audio Formats

Markua supports MP3, AAC, Ogg and WAV audio files. All audio files must be located inside the `media` directory, regardless of type. The audio files must have the correct file extension for their type.

The supported file extensions for audio files are:

.mp3
: The file is treated as MP3 audio.

.m4a, .aac
: The file is treated as an MP4 AAC (Advanced Audio Coding) audio file. Note that .mp4 is not supported as a file extension for MP4 AAC audio, since that is the file extension used for MP4 video.

.wav, .wave
: The file is treated as a WAV (Waveform Audio File Format) file.

.ogg, .oga
: The file is treated as an Ogg Vorbis file.